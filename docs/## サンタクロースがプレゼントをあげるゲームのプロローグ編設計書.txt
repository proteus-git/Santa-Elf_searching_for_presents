## サンタとエルフのプレゼントさがし＆配りゲーム 設計書

**1. ゲームの概要:**

*   **目的**: 3歳程度のこどもが、画面上のオブジェクトを操作して、プレゼントを探し出し（ステージ1）、動物たちに届ける（ステージ2）ことで、想像力と探求心を育む。
*   **構成**: 全2ステージ構成。
    *   **ステージ1 (Search)**: 森の中でプレゼントを探す。
    *   **ステージ2 (Delivery)**: 集めたプレゼントを動物たちに配る。
*   **対象年齢**: 3歳以上
*   **主要な機能**:
    *   **キャラクターの追従移動**: トナカイ→そり→サンタの順で「ゴム紐」のように伸縮しながら追従。
    *   **動的なサイズ変化**: 移動速度に応じてキャラクターが伸縮（速いと小さく、遅いと大きく）。
    *   **ドラッグ＆ドロップ**: 左クリック/タッチでの直感的な操作。
    *   **セーフポジショニング**: ターゲット選択時、UIや他オブジェクトと重ならない「安全な場所」へ自動移動。

---

### **ステージ1: プレゼント探し (index.html)**

**1. 画面構成:**
*   **背景**: `snow-coveredtreehouse.webp` (昼の雪景色)
*   **UI**:
    *   **ヘッダー**: タイトル表示。
    *   **エルフの指示 (Top Center)**: エルフが探すべき「ターゲット」をアイコンと名前で指示。クリックでスキップ（パス）し、ターゲットを再配置。
    *   **インベントリ (Bottom Left)**: 「サンタのあかい袋」。回収したアイテムがここに格納・表示される。
    *   **サウンド制御**: BGMのON/OFF切り替えボタン。
*   **オブジェクト**:
    *   **プレゼント**: どんぐり、木の実、ニンジン、マフラー、歯ブラシ、王冠。
    *   **装飾**: 石ころ、葉っぱ、小枝、木など（ドラッグ可能だがターゲット外）。

**2. ゲームルール:**
*   **操作**: 画面上のオブジェクトをドラッグして、左下の「サンタの袋」に入れる。
*   **ターゲット指示**:
    *   エルフが指定したアイテムを探す。
    *   ターゲットが見つかりにくい場合、エルフの吹き出しをクリックすると「パス」ができ、次のターゲットへ切り替わると同時に、対象オブジェクトが**見やすい位置へ自動移動**する。
*   **クリア条件**: 各種類のプレゼントを規定数（2個ずつなど）集める。
*   **クリア演出**:
    *   "Merry Christmas!" のタグが表示される。
    *   サンタたちが画面奥（遠方）へ飛び去るアニメーション。
    *   フェードアウトしてステージ2へ遷移。

---

### **ステージ2: プレゼント配り (stage2.html)**

**1. 画面構成:**
*   **背景**: `nightsnow-coveredtreehouse.webp.png` (夜の雪景色)
*   **視覚効果**:
    *   **雪**: 降り積もる雪のアニメーション。
    *   **星空**: きらめく星と、サンタを追いかける**流れ星**（大きく、明るい）。
*   **キャラクター**:
    *   動物たち: リス、ウサギ、キリン、ライオン、ワニ。
    *   **登場演出**: ドアから飛び出し、定位置へ移動したあと、個別のタイミングでゆらゆら揺れる（Swayアニメーション）。

**2. ゲームルール:**
*   **操作**: インベントリ（左端からスライドイン）からプレゼントをドラッグして、対応する動物に渡す。
*   **正解判定**:
    *   **Happy演出**: 正しいプレゼントを渡すと、黒背景のオーバーレイ表示。サンタと動物が向かい合い、プレゼントが手渡される。
    *   **表情変化**: 動物が「喜び」の画像（Smile等）に切り替わる。
    *   **装着**: 渡したプレゼントが動物の頭上に表示され、一緒に揺れる。
*   **クリア条件**: すべての動物にプレゼントを渡す。

**3. フィナーレ演出:**
*   全員に配り終えると、動物たちが一斉に "Thank you Santa!" と吹き出しで感謝。
*   **インタラクティブ・フィナーレ**:
    *   プレイヤーがサンタを操作してツリーハウスの周りを旋回。
    *   **キラキラメッセージ**: "Merry Christmas!" の文字が金色に輝き、最初は画面全体に、その後はサンタに追従して回る。
    *   サンタたちが徐々に小さくなり、夜空の彼方へ消えていく（エンドロール的な演出）。

---

### **技術仕様 (共通)**

**1. ファイル構成:**
*   `index.html`: ステージ1（エントリーポイント）
*   `stage2.html`: ステージ2
*   `image/`: 画像アセットフォルダ
*   `audio/`: 音声アセットフォルダ

**2. 実装のポイント:**
*   **レスポンシブ**: PC/スマホ両対応。タッチイベント(`touchstart`, `touchmove`, `touchend`)とマウスイベントを統合的に処理。
*   **物理挙動風アニメーション**:
    *   `requestAnimationFrame` を使用したスムーズな移動。
    *   各パーツ（トナカイ・そり・サンタ）が少し遅れてついてくることで「連結感」を表現。
*   **セーフポジショニング (Safe Positioning)**:
    *   オブジェクト配置時に「UIエリア（エルフ、インベントリ）」と「他オブジェクト」との重なりを計算し、回避するロジックを実装。
    *   ユーザビリティ向上（D&Dの誤操作防止）のための重要機能。
